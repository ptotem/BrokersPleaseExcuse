<%= content_for :head do %>

    <script type="text/javascript">
        $(function () {
            $(".chzn-container-multi").chosen();
            $(".chzn-select").chosen();
            $('#all_flats').dataTable({
                "bJQueryUI":true,
                "sPaginationType":"full_numbers",
                "iDisplayLength":4,
                "sDom":'rtfp'
            });
            $('#all_services').dataTable({
                "bJQueryUI":true,
                "sPaginationType":"full_numbers",
                "iDisplayLength":4,
                "sDom":'rtfp'
            });

        })

    </script>
    <style type="text/css">

        input, textarea, chzn-select, .chzn-container-single .chzn-single, .chzn-container-multi .chzn-choices, .blocky, input[type='checkbox'] {
            background: rgb(252, 234, 187); /* Old browsers */
            background: -moz-linear-gradient(top, rgb(252, 234, 187) 0%, rgb(252, 205, 77) 50%, rgb(251, 223, 147) 100%); /* FF3.6+ */
            background: -webkit-gradient(linear, left top, left bottom, color-stop(0%, rgb(252, 234, 187)), color-stop(50%, rgb(252, 205, 77)), color-stop(100%, rgb(251, 223, 147))); /* Chrome,Safari4+ */
            background: -webkit-linear-gradient(top, rgb(252, 234, 187) 0%, rgb(252, 205, 77) 50%, rgb(251, 223, 147) 100%); /* Chrome10+,Safari5.1+ */
            background: -o-linear-gradient(top, rgb(252, 234, 187) 0%, rgb(252, 205, 77) 50%, rgb(251, 223, 147) 100%); /* Opera 11.10+ */
            background: -ms-linear-gradient(top, rgb(252, 234, 187) 0%, rgb(252, 205, 77) 50%, rgb(251, 223, 147) 100%); /* IE10+ */
            filter: progid:DXImageTransform.Microsoft.gradient(startColorstr = '#fceabb', endColorstr = '#fbdf93', GradientType = 0); /* IE6-9 */
        }

        .chzn-container-multi .chzn-choices .search-field .default {
            color: black;
        }

        .topped {
            border-top: 1px solid #d3d3d3;
            padding-top: 5px;
            margin-top: 5px;
        }

        .blocky {
            border: solid 1px black;
            padding: 5px;
            margin-top: 3px;
            border-radius: 5px;
        }

        #mapa {
            width: 500px;
            height: 340px;
            border: 5px solid darkgray;
            margin-top: -30px;
        }

        a:hover {
            text-decoration: none;
            background: transparent;
        }

        .dropdown.open .dropdown-toggle {
            background: transparent;
            color: black;
            font-weight: bold;
        }

        label input, label textarea, label select {
            display: inline;
        }

    </style>

<% end %>

<%= nested_form_for(@building) do |f| %>

    <div class="content" style="margin-top: 25px;">

      <div class="row">
        <h1 style="margin-left: 20px"> Property
        </h1>
      </div>
    </div>


    <div id="form_wrapper">
    <div id="steps">

    <fieldset class="step">
      <legend style="padding:20px;">
        <% if @building.name.blank? %>
            New Building
        <% else %>
            <%= @building.name %>
        <% end %>
        <div class="pull-right" style="margin-right: 100px;">
          <div class="dropdown">
            <a class="dropdown-toggle"
               data-toggle="dropdown"
               href="#">
              Select a Building
              <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
              <li><%= link_to "New Building", new_building_path %></li>
              <li class="divider"></li>
              <% @buildings.each do |building| %>
                  <li style="font-size:12px;"><%= link_to building.name, edit_building_path(building) %></li>
              <% end %>
            </ul>
          </div>
        </div>
      </legend>
      <div>
        <div class="row" style="padding-left:20px;">
          <div class="span4">
            <div class="row-fluid">
              <div class="span3">
                <%= f.label :name %>
              </div>
              <div class="span4">
                <%= f.text_field :name, :class => "span3" %>
              </div>
            </div>
            <div class="row-fluid">
              <div class="span3">
                <%= f.label "Locality" %>
              </div>
              <div class="span4">
                <%= f.select :primary_locality_id, options_from_collection_for_select(@localities, :id, :name, @building.primary_locality_id), {:include_blank => ''}, {:class => "chzn-select span3", :'data-placeholder' => "Primarily belongs to..."} %>
              </div>
            </div>
            <div class="row-fluid">
              <div class="span3">
                <%= f.label "Also in" %>
              </div>
              <div class="span4">
                <%= hidden_field_tag "building[locality_ids][]", nil %>
                <%= select_tag "building[locality_ids][]", options_from_collection_for_select(@localities, :id, :name, @building.locality_ids), :multiple => true, :class => "chzn-container-multi span3", :'data-placeholder' => "Also belongs to..." %>
              </div>
            </div>
            <br/>

            <div class="row-fluid">
              <div class="span3">
                Quality:
              </div>
              <div class="span4">
                <%= f.fields_for :building_qualities do |builder| %>
                    <%= builder.select :quality_id, options_from_collection_for_select(@qualities, :id, :name, @bldgq.quality_id), {}, {:class => "chzn-select span3", :'data-placeholder' => "Select Quality"} %>
                <% end %>
              </div>
            </div>

            <div class="row-fluid">
              <div class="span3">
                Approach:
              </div>
              <div class="span4">
                <%= f.fields_for :approach_qualities do |builder| %>
                    <%= builder.select :quality_id, options_from_collection_for_select(@qualities, :id, :name, @appq.quality_id), {}, {:class => "chzn-select span3", :'data-placeholder' => "Select Quality"} %>
                <% end %>
              </div>
            </div>

            <div class="row-fluid">
              <div class="span3">
                Locality:
              </div>
              <div class="span4">
                <% unless @building.primary_locality_id.blank? %>
                    <select class="chzn-select span3">
                      <option>
                        <%= Locality.find(@building.primary_locality_id).quality.name %>
                      </option>
                    </select>
                <% end %>
              </div>
            </div>
            <br/>

          </div>

          <div class="span8">
            <div class="row-fluid">
              <div class="span11">
                <div class="row-fluid"><h3>Flats</h3>
                  <table>
                    <%= f.fields_for :flats do |flat| %>
                        <% if flat.object.new_record? %>
                            <tr>
                              <td><%= flat.select :bhk_config_id, options_from_collection_for_select(@bhk_configs, :id, :name), {:multiple => false}, {:class => "chzn-select span3", :'data-placeholder' => "Select Configuration"} %></td>
                              <td><%= flat.text_field :name, :class => "span3", :style => "margin-top:5px;" %></td>
                              <td><%= f.submit "Add", :class => "btn btn-inverse span1", :style => "margin-top:-4px;" %></td>
                            </tr>
                        <% end %>
                    <% end %>
                  </table>

                  <%= render :partial => 'flats_table' %>
                  <br/>

                  <div class="row-fluid">
                    <%= f.text_area :qknote, :rows => 2, :class => "span12", :placeholder => "Enter Background Information here" %>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </fieldset>

    <fieldset class="step">
      <legend style="padding:20px;">Map</legend>
      <div>
        <div class="row" style="padding:20px;">
          <div class="span7">
            <!--<script src="http://maps.google.com/maps?file=api&v=2&key=ABQIAAAA7A7Eu8gZ_mTslgWnRR9TGRQByQgPDcFg0q0wOb9u6rRtBOFyKBQD4QgfPHRxBFGL7JviJdz_jAlHfw" type="text/javascript"></script>-->
            <div id="mapa"></div>
          </div>
          <div class="span4" style="overflow-y:auto; height: 330px;">

            <div class="row-fluid">
              <div class="span3">
                <%= f.label :address %>
              </div>
              <div class="span4">
                <%= f.text_field :address, :class => "span3" %>
              </div>
            </div>
            <div class="row-fluid">
              <div class="span3">
                <%= f.label :road %>
              </div>
              <div class="span4">
                <%= f.text_field :road, :class => "span3" %>
              </div>
            </div>
            <div class="row-fluid">
              <div class="span3">
                <%= f.label :pincode %>
              </div>
              <div class="span4">
                <%= f.number_field :pincode, :class => "span3" %>
              </div>
            </div>
            <div class="row-fluid">
              <div class="span3">
                <%= f.label :latitude %>
              </div>
              <div class="span4">
                <%= f.number_field :latitude, :class => "span3" %>
              </div>
            </div>
            <div class="row-fluid">
              <div class="span3">
                <%= f.label :longitude %>
              </div>
              <div class="span4">
                <%= f.number_field :longitude, :class => "span3" %>
              </div>
            </div>

            Directions: <%= f.link_to_add 'Add Route', :building_routes %> <br/>
            <%= f.fields_for :building_routes do |builder| %>
                <%= builder.text_area :comment, :rows => 3, :class=>"span3" %>
                <%= builder.link_to_remove "Remove" %> <br/>
            <% end %>
          </div>

        </div>
      </div>
    </fieldset>

    <fieldset class="step">
      <legend style="padding:20px;">Amenities</legend>
      <div>
        <div class="row" style="overflow-y: auto; height:340px;">
          <div class="span9 offset1">
            <%= hidden_field_tag "building[facility_ids][]", nil %>
            <% @facilities.each do |facility| %>
                <%= check_box_tag "building[facility_ids][]", facility.id, @building.facility_ids.include?(facility.id), id: dom_id(facility), :onchange => "$(this).next().next().toggle();" %>
                <%= label_tag dom_id(facility), facility.name %>
                <% if @building.facility_ids.include?(facility.id) %>
                    <div class="blocky">
                      <%= hidden_field_tag "building[facility_feature_ids][]", nil %>
                      <% facility.facility_features.each do |facility_feature| %>
                          <%= check_box_tag "building[facility_feature_ids][]", facility_feature.id, @building.facility_feature_ids.include?(facility_feature.id), id: dom_id(facility_feature) %>
                          <%= label_tag dom_id(facility_feature), facility_feature.name %>
                      <% end %>
                    </div>
                    <br/>
                <% else %>
                    <div style="display:none;" class="blocky">
                      <%= hidden_field_tag "building[facility_feature_ids][]", nil %>
                      <% facility.facility_features.each do |facility_feature| %>
                          <%= check_box_tag "building[facility_feature_ids][]", facility_feature.id, @building.facility_feature_ids.include?(facility_feature.id), id: dom_id(facility_feature) %>
                          <%= label_tag dom_id(facility_feature), facility_feature.name %>
                      <% end %>
                    </div>
                    <br/>
                <% end %>
            <% end %>
          </div>
        </div>
      </div>
    </fieldset>

    <fieldset class="step">
      <legend style="padding:20px;">Technical Details</legend>
      <div>
        <div class="row" style="overflow-y: auto; height:340px;">
          <div class="row">
            <div class="span2 offset1">
              Restrictions
            </div>
            <div class="span8">

              <% @restrictions.each_with_index do |restriction, index| %>
                  <%= check_box_tag "building[restriction_ids][]", restriction.id, @building.restriction_ids.include?(restriction.id), id: dom_id(restriction) %>
                  <%= label_tag dom_id(restriction), restriction.name %>
                  <% if (index+1) % 4 == 0 %>
                      <br/>
                  <% end %>
              <% end %>
              <br/>
            </div>
          </div>
          <div class=" topped row">
            <div class="span2 offset1">
              Moving Details
            </div>
            <div class="span8">

              <% @moving_requirements.each_with_index do |moving_requirement, index| %>
                  <%= check_box_tag "building[moving_requirement_ids][]", moving_requirement.id, @building.moving_requirement_ids.include?(moving_requirement.id), id: dom_id(moving_requirement) %>
                  <%= label_tag dom_id(moving_requirement), moving_requirement.name %>
                  <% if (index+1) % 4 == 0 %>
                      <br/>
                  <% end %>
              <% end %>
              <br/>
              <br/>
              <%= fields_for :moving_charges do |builder| %>
                  Moving Charge:<br/> <%= builder.text_field :value, :class => "span6" %>
              <% end %>
            </div>
          </div>
        </div>
      </div>
    </fieldset>

    <fieldset class="step">
      <legend style="padding:20px;">Notes</legend>
      <div>
        <div class="row" style="padding:20px;">
          <div class="span12" style="overflow-y:auto; height: 330px;">
            <%= f.link_to_add 'Add Note', :building_notes %> <br/>

            <%= f.fields_for :building_notes do |builder| %>
                <%= builder.text_area :comment, :rows => 2, :class => "span11" %>
                <%= builder.link_to_remove "Remove" %>
            <% end %>
          </div>

        </div>
      </div>
    </fieldset>

    <fieldset class="step">
      <legend style="padding:20px;">Services</legend>
      <div>
        <div class="row" style="padding:20px;">
          <div class="span4" style="overflow: auto;height:320px;padding-right:40px;margin-top: -20px; margin-left: 20px;">
            <h3>Add New Service</h3>
            <br/>
            <%= f.fields_for :building_services do |building_service| %>
                <% if building_service.object.new_record? %>
                    <%= building_service.select :service_id, options_from_collection_for_select(@services, :id, :name), {:multiple => false}, {:class => "chzn-select span3", :'data-placeholder' => "Select Service"} %>
                    <br/>
                    <%= building_service.text_field :name, :class => "span3", :style => "margin-top:5px;", :placeholder => "Name" %>
                    <br/>
                    <%= building_service.link_to_add 'Add helpline', :building_service_helplines %> <br/>

                    <%= building_service.fields_for :building_service_helplines do |repeater| %>
                        <%= repeater.text_field :phone, :placeholder => "Helpline Number" %>
                        <%= repeater.link_to_remove "Remove" %>
                    <% end %>
                    <br/>
                    <%= building_service.link_to_add 'Add Note', :building_service_notes %> <br/>

                    <%= building_service.fields_for :building_service_notes do |builder| %>
                        <%= builder.text_area :comment, :rows => 2, :placeholder => "Building Note" %>
                        <%= builder.link_to_remove "Remove" %>
                    <% end %>
                    <br/>
                    <%= f.submit "Add", :class => "btn btn-inverse span1", :style => "margin-top:-4px;" %>
                <% end %>
            <% end %>
            </table>
          </div>
          <div class="span7">
            <%= render :partial => 'building_services_table' %>
          </div>
          <br/>

        </div>
      </div>
    </fieldset>


    </div>

    <div id="navigation" style="display:none;">
      <ul>
        <li class="selected">
          <a href="#"> Building </a>
        </li>
        <li>
          <a href="#"> Map </a>
        </li>
        <li>
          <a href="#"> Amenities </a>
        </li>
        <li>
          <a href="#"> Technicals </a>
        </li>
        <li>
          <a href="#"> Notes </a>
        </li>
        <li>
          <a href="#"> Services </a>
        </li>
      </ul>
      <%= f.submit "Save", :class => "btn btn-primary pull-right btn-large", :style => "margin-top:2px;margin-right:10px;" %>
    </div>
    </div>
    <br/>

<% end %>
