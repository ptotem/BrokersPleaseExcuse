<%= nested_form_for(@building) do |b| %>
    <%= b.fields_for :flats, @flat do |f| %>


        <%= hidden_field_tag :came_from, "flat_features" %>
        <%= hidden_field_tag :flat_id, @flat.id %>
        <%= render :partial => 'form_menu' %>

        <br>
        <div class="content detail-panel" id="basic-panel">

          <div class="row-fluid">
            <div class="span4">

              <h2>Flat Details</h2>
              <%= f.hidden_field :name, :value => @flat.name %>
              <%= f.hidden_field :bhk_config_id, :value => @flat.bhk_config_id %>

              <div>
                <div class="row-fluid">
                  <div class="span3">
                    Area:
                  </div>
                  <div class="span2">
                    <%= f.text_field :area, :value => @flat.area %>
                  </div>
                </div>
                <div class="row-fluid">
                  <div class="span3">
                    Floor:
                  </div>
                  <div class="span2">
                    <%= f.text_field :floor, :value => @flat.floor %>
                  </div>
                </div>

                <br>

                <div class="row-fluid">
                  <div class="span3">
                    Direction Facing:
                  </div>
                  <div class="span2">
                    <%= f.select :direction_id, options_from_collection_for_select(@directions, :id, :name, @flat.direction_id), {}, {:class => "chzn-select span3", :'data-placeholder' => "Select a Direction"} %>
                  </div>
                </div>
                <div class="row-fluid">
                  <div class="span3">
                    Interiors Quality:
                  </div>
                  <div class="span2">
                    <%= f.select :interiors_quality_id, options_from_collection_for_select(@qualities, :id, :name, @flat.interiors_quality_id), {}, {:class => "chzn-select span3", :'data-placeholder' => "Select Quality"} %>
                  </div>
                </div>
                <div class="row-fluid">
                  <div class="span3">
                    View Quality:
                  </div>
                  <div class="span2">
                    <%= f.select :view_quality_id, options_from_collection_for_select(@qualities, :id, :name, @flat.view_quality_id), {}, {:class => "chzn-select span3", :'data-placeholder' => "Select Quality"} %>
                  </div>
                </div>

                <h2>Flat Notes</h2>

                <%= f.fields_for :flat_notes do |builder| %>
                    <%= builder.text_area :name, :rows => 2, :class => "span3" %>
                    <%= builder.link_to_remove "Remove" %>
                <% end %>

                <%= f.link_to_add 'Add Note', :flat_notes %>
                <br/>
                <br/>

                <%= b.submit "Save and Continue", :class => "submitter btn btn-primary btn-large", :id => "submit-basic" %>

              </div>
            </div>
            <div class="span3">
              <h2>Flat Essentials</h2>

              <div>
                <% @bathrooms.each do |bathroom| %>
                    <%= f.fields_for :bathrooms, bathroom do |builder| %>
                        <div class="row-fluid">
                          <div class="span9">
                            <%= builder.label bathroom.bathroom_type.name %>
                          </div>
                          <div class="span1">
                            <%= builder.text_field :value, :value => bathroom.value, :class => "span1" %>
                          </div>
                        </div>
                    <% end %>
                <% end %>
              </div>

              <div>
                <% @balconies.each do |balcony| %>
                    <%= f.fields_for :balconies, balcony do |builder| %>
                        <div class="row-fluid">
                          <div class="span9">
                            <%= builder.label balcony.balcony_type.name %>
                          </div>
                          <div class="span1">
                            <%= builder.text_field :value, :value => balcony.value, :class => "span1" %>
                          </div>
                        </div>
                    <% end %>
                <% end %>
              </div>

              <div>
                <% @parkings.each do |parking| %>
                    <%= f.fields_for :parkings, parking do |builder| %>
                        <div class="row-fluid">
                          <div class="span9">
                            <%= builder.label parking.parking_type.name %>
                          </div>
                          <div class="span1">
                            <%= builder.text_field :value, :value => parking.value, :class => "span1" %>
                          </div>
                        </div>
                    <% end %>
                <% end %>
              </div>

              <br>
            </div>

            <div class="span5">
              <h2>Flat Features</h2>

              <div class="row-fluid">
                <div class="span12">
                  <% @flat_facilities.each do |facility| -%>
                      <div>
                        <%= hidden_field_tag 'flat[facility_ids][]', nil %>
                        <%= check_box_tag :facility_ids, facility.id, @flat.facilities.include?(facility), :name => 'flat[facility_ids][]', :onchange => "$(this).next().next().toggle();" %>
                        <%= label_tag :facility_ids, facility.name -%>

                        <% if @flat.facility_ids.include?(facility.id) %>
                            <div class="blocky">
                              <%= hidden_field_tag 'flat[facility_feature_ids][]', nil %>
                              <% facility.facility_features.each do |facility_feature| %>
                                  <%= check_box_tag :facility_feature_ids, facility_feature.id, @flat.facility_features.include?(facility_feature), :name => 'flat[facility_feature_ids][]' %>
                                  <%= label_tag :facility_feature_ids, facility_feature.name -%>
                              <% end %>
                            </div>
                            <br/>
                        <% else %>
                            <div style="display:none;" class="blocky">
                              <%= hidden_field_tag 'flat[facility_feature_ids][]', nil %>
                              <% facility.facility_features.each do |facility_feature| %>
                                  <%= check_box_tag :facility_feature_ids, facility_feature.id, @flat.facility_features.include?(facility_feature), :name => 'flat[facility_feature_ids][]' %>
                                  <%= label_tag :facility_feature_ids, facility_feature.name -%>
                              <% end %>
                            </div>
                            <br/>
                        <% end %>


                      </div>
                  <% end -%>
                </div>
              </div>

              <br>

              <h2>Flat Restrictions</h2>

              <div>
                <div class="row-fluid">
                  <div class="span6">
                    <% @restrictions.each do |restriction| %>
                        <%= check_box_tag "flat[restriction_ids][]", restriction.id, @flat.restriction_ids.include?(restriction.id), id: dom_id(restriction) %>
                        <%= label_tag dom_id(restriction), restriction.name %>
                        <br>
                    <% end %>
                  </div>
                </div>
              </div>


            </div>
          </div>
        </div>
    <% end %>
<% end %>