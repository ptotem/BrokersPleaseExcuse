<%= javascript_include_tag "exclusions/dhtmlxcommon" %>
<%= javascript_include_tag "exclusions/dhtmlxgrid" %>
<%= javascript_include_tag "exclusions/dhtmlxgrid_filter" %>
<%= javascript_include_tag "exclusions/dhtmlxgrid_srnd" %>
<%= javascript_include_tag "exclusions/dhtmlxgrid_start" %>
<%= javascript_include_tag "exclusions/dhtmlxgridcell" %>


<h1>Listing contacts</h1>

<table id="dhtmlx_contacts_table">
  <tr>
    <th>Name</th>
    <th>Phone</th>
    <th>Email</th>
    <th>Labels</th>
    <th>Properties Linked</th>
    <th>Last Interaction</th>
    <th>Next Task</th>
    <th>Client Type</th>
    <th>Last Interaction Date</th>
  </tr>
  <% @contacts.each do |contact| %>
      <tr>
        <td><%= link_to contact.name, contact_path(contact), :target => "_blank" %></td>
        <td><%= contact.phones.map { |phone| phone.name }.join(",") %></td>
        <td><a href="mailto:<%= contact.emails.map { |email| email.name }.join(",") %>"><%= contact.emails.map { |email| email.name }.join(",") %></a></td>
        <td><%= contact.labellings.map { |label| label.name }[0..3].join(",") %></td>
        <td><%= contact.flats.map { |flat| flat.name }[0..3].join(",") %></td>
        <%#These methods are defined in contact helpers  %>
        <td><%= get_interaction_td_for_contact(contact) %></td>
            <td><%= due_overdue_task_count(contact) %></td>
            <td><%= contact.contact_types.first.name %></td>
        <td><%= get_interaction_date(contact) %></td>
            </tr>
        <% end %>
</table>

<br/>


<script type="text/javascript">


    var mygrid;
    function doInitGrid() {
        mygrid = new dhtmlXGridFromTable("dhtmlx_contacts_table");

        mygrid.setSkin("bpe");
        mygrid.attachHeader("#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter");
        mygrid.enableAutoWidth(true);
        mygrid.enableAutoHeight(true);

        mygrid.setSizes();


        mygrid.setColWidth(0, 120);
        mygrid.setColWidth(1, 60);
        mygrid.setColWidth(2, 140);
        mygrid.setColWidth(3, 100);
        mygrid.setColWidth(4, 100);
        mygrid.setColWidth(5, 300);
        mygrid.setColWidth(6, 200);
    }

    $(function () {
        doInitGrid();
        $(".interaction_link").click(function () {

            //alert("index");
            $('#modal_' + $(this).attr("id") + "_index").modal('show');
        });


    });

</script>