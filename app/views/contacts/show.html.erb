<%= content_for :head do %>

    <style type="text/css">
        a.lefty {
            color: white;
        }

        a.lefty:hover {
            color: #daa520;
        }

        body {
            background: black;
        }
    </style>

    <script type="text/javascript">
        $(function () {

        });
    </script>

<% end %>

<%= semantic_form_for @contact do |f| %>

    <div class="row-fluid" style="width:101%;margin-top: -5px;">

      <!-- Left Banner -->

      <div class="span2" style="margin-left: -10px;font-size: 12px;">
        <div class="info-unit page-sized" style="background: black;border:none;">
          <h3 style="color:white;">
            <%= @contact.name.titlecase %>
          </h3>
          <br>

          <div class="blocky">
            <%= @contact.contact_types.first.name unless @contact.contact_types.blank? %>
          </div>
          <div class="blocky">
            <% if @contact.phones.blank? %>
                No Phones
            <% else %>
                <%= @contact.phones.first.name %>
            <% end %>
          </div>
          <div class="blocky">
            <% if @contact.emails.blank? %>
                No Emails
            <% else %>
                <%= @contact.emails.first.name %>
            <% end %>
          </div>
          <div style="margin-left: -20px;margin-top: 10px; height:100px;">
            <a href="#moreinfo" data-toggle="modal" data-backdrop="static" class="btn btn-info span2 sized">More
              Info</a>
            <a href="#link_property" data-toggle="modal" data-backdrop="static" class="btn span2 sized">Link
              Property</a>
            <%= link_to "Link Contact", "#", :class => "btn span2 sized" %>
          </div>

          <div class="orangey">
            <h3>Add Labels</h3>
            <%= select_tag "contact[labelling_ids][]", options_from_collection_for_select(Labelling.all, :id, :name, @contact.labelling_ids), :multiple => true, :class => "chzn-container-multi", :'data-placeholder' => "Select Options", :style => "width:100%;border-radius:5px;" %>
            <%= f.submit "Update", :style=>"width:100%; height:40px;", :class=>"btn btn-inverse" %>
          </div>


          <div class="content" style="display:none;padding:0;height:450px;overflow: auto;">


            <div class="row-fluid">
              <div class="span9" style="font-weight: bold;">
                <h3 style="margin-bottom: 5px;">Properties</h3>
              </div>
              <table>

              </table>

              <%= link_to "Add Property", new_property_path(:contact => @contact.id) %>

            </div>
            <br/>

            <div class="row-fluid">
              <div class="span5" style="font-weight: bold;">
                <h3>Connections</h3>
                <table>
                  <%= f.fields_for :connections do |connection| %>
                      <% if connection.object.new_record? %>
                          <tr>
                            <td><%= connection.select :other_id, options_from_collection_for_select(@contacts, :id, :name), {:multiple => false}, {:class => "chzn-select input-medium", :'data-placeholder' => "Select Contact"} %></td>
                          </tr>
                          <tr>
                            <td><%= connection.text_field :relationship, :class => "input-medium", :style => "margin-top:5px;" %></td>
                          </tr>
                          <tr>
                            <td><%= f.submit "Add", :class => "btn btn-inverse span1", :style => "margin-top:-4px;" %></td>

                          </tr>
                      <% end %>
                  <% end %>

                </table>
                <a data-backdrop="static" data-toggle="modal" href="#add_contact">Add contact!</a>
                <br/>
                <%= render :partial => 'connections_table' %>
              </div>
              <br/>
            </div>
          </div>
        </div>
      </div>

      <!--Tasks and Interactions Panel-->

      <div class="span10">
        <div class="row-fluid">
          <%= render "/layouts/partials/interaction_tasks_partial", :f => f %>
        </div>
      </div>
    </div>

    <!--Details Modal -->

    <div id="moreinfo" class="modal hide fade">
      <div class="modal-header">
        <h1><%= @contact.name %></h1>
      </div>
      <div class="modal-body">
        <div class="row-fluid">
          <div class="span3" style="text-align: left;margin-left: 0;font-weight: bold">Phone:</div>
          <div class="span9">
            <% @contact.phones.each do |phone| %>
                <%= phone.name %>
                <br/>
            <% end %>
          </div>
        </div>

        <div class="row-fluid">
          <div class="span3" style="text-align: left;margin-left: 0;font-weight: bold">Email:</div>
          <div class="span9">
            <% @contact.emails.each do |email| %>
                <%= email.name %>
                <br/>
            <% end %>
          </div>
        </div>

        <div class="row-fluid">
          <div class="span3" style="text-align: left;margin-left: 0;font-weight: bold">Address:</div>
          <div class="span9">
            <% @contact.addresses.each do |address| %>
                <%= raw(address.name) %>
                <br/>
            <% end %>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <div class="pull-left close"><%= link_to "Edit", edit_contact_path(@contact) %></div>
        <div class="close" data-dismiss="modal">Back</div>
      </div>
    </div>

    <!--Link Property Modal -->

    <div class="modal hide fade" id="link_property">
      <div class="modal-header">
        <a class="close" data-dismiss="modal">×</a>

        <h3>Link a Property</h3>
      </div>
      <div class="modal-body">
        <%= f.fields_for :flat_contacts do |flat_contact| %>
            <% if flat_contact.object.new_record? %>
                <%= flat_contact.select :flat_id, options_from_collection_for_select(Flat.all, :id, :flat_key), {:multiple => false}, {:class => "chzn-select input-medium", :'data-placeholder' => "Select Property"} %>
                <%= flat_contact.select :name, options_from_collection_for_select(@labellings, "id", "name"), :class => "input-small", :style => "margin-top:5px;" %>
                <br>
                <%= f.submit "Add", :class => "btn btn-inverse btn-large span1", :style => "margin-top:-4px;" %>
            <% end %>
        <% end %>
      </div>
    </div>



<% end %>


<!--Modal for contact form-->

<br>

<div class="modal hide fade" id="add_contact">
  <div class="modal-header">
    <a class="close" data-dismiss="modal">×</a>

    <h3>Add a Contact</h3>
  </div>
  <div class="modal-body">
    <%= form_for @new_contact do |contact| %>
        <div class="blabel">Name</div>
        <%= contact.text_field :name %>
        <br>
        <%= contact.fields_for :phones, @phone do |phone| %>
            <div class="blabel">Phone</div>
            <%= phone.phone_field :name %>
        <% end %>
        <br>
        <%= contact.fields_for :emails, @email do |email| %>
            <div class="blabel">Email</div>
            <%= email.text_field :name %>
        <% end %>
        </div>
        <div class="modal-footer">
          <%= contact.submit "Save Changes", :class => "btn btn-primary" %>
          <a href="#" class="btn btn-danger" data-dismiss="modal">Close</a>
        </div>

    <% end %>
    </div>

