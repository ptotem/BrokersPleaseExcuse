<%= content_for :head do %>
    <script type="text/javascript">
        $(function () {
            $('.summary-task').click(function () {
                $(this).parent().find('.detailed-task').slideDown();
                $(this).hide();
            });
            $('.detailed-task a.collapser').click(function () {
                $(this).parent().parent().parent().find('.detailed-task').hide();
                $(this).parent().parent().parent().find('.summary-task').show();
            });
        })
    </script>
<% end %>
<div class="row-fluid">
  <div class="span2">
    <div class="info-unit">
      <h2>Cheers</h2>
      <span style="font-weight: normal;font-size: 12px;">When the house is rocking, don't bother knocking...</span>
      <br>

      <div class="blocky"><%= Flat.all.count %> Properties in database</div>
      <div class="blocky"><%= Flat.all.count %> Properties available</div>
      <div class="blocky"><%= Flat.all.count %> Properties available</div>
      <div class="blocky"><%= Flat.all.count %> Properties available</div>

    </div>
    <div>
      <%= link_to "Property Search", "#", :class => "btn btn-inverse span2 sized" %>
      <%= link_to "Contact Search", "#", :class => "btn span2 sized" %>
      <%= link_to "Broker Search", "#", :class => "btn span2 sized" %>
      <%= link_to "Recently Viewed", "#", :class => "btn span2 sized" %>
      <%= link_to "Frequently Viewed", "#", :class => "btn span2 sized" %>
      <%= link_to "Deals", "#", :class => "btn span2 sized" %>
      <%= link_to "Data and Graphs", "#", :class => "btn span2 sized" %>
      <%= link_to "Projects", "#", :class => "btn span2 sized" %>
      <%= link_to "Settings", "#", :class => "btn span2 sized" %>
      <%= link_to "Got Game?", "#", :class => "btn span2 sized" %>
      <%= link_to "Intranet", "#", :class => "btn btn-inverse span2 sized" %>
    </div>
  </div>

  <div class="span10">
    <div class="span6">
      <div class="info-unit page-sized">

        <!--Header and Search for Tasks-->
        <h2>
          Tasks
          <div class="pull-right">
            <%= select_tag :status, options_for_select([["All", "1"], ["Due", "2"], ["Overdue", "3"]]), {:style => "width:80px"} %>
            <%= select_tag :role, options_for_select([["All", "1"], ["Assigned", "2"], ["Involved", "3"]]), {:style => "width:80px"} %>
            <%= select_tag :players, options_from_collection_for_select(Contact.all, 'id', 'name'), {:class => "span3 chosen-select"} %>
          </div>
        </h2>
        <br>
        <br>
        <!---->

        <!-- Tasks Panel -->

        <%#= TODO Please include jScrollPane for the scrolling here %>
        <%#= TODO Build the filters using the Select tags above %>

        <% @tasks.each_with_index do |task, index| %>
            <% if task.active %>
                <div class="row-fluid" style="margin-bottom: 5px;">
                  <div>
                    <div class="summary-task blocky">
                      <% @primary_contact = task.interaction.interaction_contacts.first.contact %>
                      <%= @primary_contact.name %> |
                      <%#= @primary_contact.phones.first.name %> 9833939793 |
                      <%#= @primary_contact.emails.first.name %> arijit@ptotem.com
                      <div class="pull-right"><%= task.due_date.strftime("%e %b") %></div>
                      <br>

                      <div style="font-weight: normal"><%= "#{raw task.interaction.name[0..60]} ...." %></div>
                    </div>
                    <div class="detailed-task" style="display: none;">
                      <div class="row-fluid">
                        <div class="span9">
                          <%= raw task.interaction.name %>
                          <br/>
                          <br/>
                        </div>
                        <div class="span3" style="text-align: right;">
                          <h2><%= task.due_date.strftime("%e %b") %></h2>
                          <br/>
                        </div>
                      </div>
                      <div class="row-fluid ">
                        <div class="span12 onlyhead" style="margin-left: -4px;padding-left: 5px;">
                          <span style="font-weight: bold"><%= Contact.find(task.assigned_to).name %> | </span>
                          <% task.interaction.contacts.each do |contact| %>
                              <% case contact.name %>
                          <% when "Vendor" %>
                                  <% @col="#ff0000" %>
                              <% when "Client" %>
                                  <% @col="#00ff00" %>
                              <% when "Employee" %>
                                  <% @col="#0000ff" %>
                              <% when "Partner" %>
                                  <% @col="#ff00ff" %>
                              <% else %>
                                  <% @col="#ff00ff" %>
                              <% end %>

                              <style type="text/css">
                                  #cnt_<%= contact.id %>_ <%= task.id %> {
                                      color: <%= @col %>;
                                  }
                              </style>

                              <a href="<%= contact_path(contact) %>" id="cnt_<%= contact.id %>_<%= task.id %>"><%= contact.name %></a>
                              |
                          <% end %>

                        </div>
                        <a data-toggle="modal" href="#complete_task_modal<%= index %>">Mark as
                          Complete</a> |
                        <a data-toggle="modal" href="#reschedule_task_modal<%= index %>">Re-Schedule</a>
                        |
                        <a data-toggle="modal" href="#cancel_task_modal<%= index %>">Cancel</a>

                        <a class="collapser pull-right" href="#">Collapse</a>
                      </div>
                    </div>
                  </div>
                </div>


                <div class="modal fade" id="cancel_task_modal<%= index %>" style="width:840px;height:500px;">
                  <div class="modal-header">
                    <button class="close" data-dismiss="modal">×</button>
                    <h3>Cancel Task</h3>
                  </div>
                  <div class="modal-body">
                    <%= render 'interactions/form', :locals => {:task => task, :prev_comment => "Canclled"} %>
                  </div>
                  <div class="modal-footer">
                    <a href="#" class="btn">Close</a>
                  </div>
                </div>
                <div class="modal fade" id="reschedule_task_modal<%= index %>" style="width:840px;height:500px;">
                  <div class="modal-header">
                    <button class="close" data-dismiss="modal">×</button>
                    <h3>Reschedule task</h3>
                  </div>
                  <div class="modal-body">
                    <%= render 'interactions/form', :locals => {:task => task, :prev_comment => "Rescheduled"} %>
                  </div>
                  <div class="modal-footer">
                    <a href="#" class="btn">Close</a>
                  </div>
                </div>
                <div class="modal fade" id="complete_task_modal<%= index %>" style="width:840px;height:500px;">
                  <div class="modal-header">
                    <button class="close" data-dismiss="modal">×</button>
                    <h3>Mark Task As Complete</h3>
                  </div>
                  <div class="modal-body">
                    <%= render 'interactions/form', :locals => {:task => task, :prev_comment => "Marked As Complete"} %>
                  </div>
                  <div class="modal-footer">
                    <a href="#" class="btn">Close</a>
                  </div>
                </div>


            <% end %>
        <% end %>

        <!---->

      </div>
    </div>
    <div class="span7">
      <div class="info-unit page-sized">

        <!--Header and Search for Interactions-->
        <h2>
          Interactions
          <div class="pull-right">
            <!-- TODO Build an interaction table using DHTMLX (Fields: Date, InteractionType, Interaction summary, (Hidden but searchable: Added by, InteractionContacts, InteractionFlats -> Opens in a modal)  -->
          </div>
        </h2>
        <br>
        <br>
        <!---->

        <!-- Interactions Panel -->
      </div>
    </div>
  </div>


</div>